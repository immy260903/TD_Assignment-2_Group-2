import os
import maya.cmds as cmds

class MayaFileOpener:
    def __init__(self, base_path):
        self.base_path = base_path
        self.dept_paths = {
            "Assets": {"Model": "model", "Rig": "rig"},
            "Shots": {"Layout": "layout", "Animation": "animation", "Lighting": "lighting"}
        }
        self.current_dept = None
        self.current_task = None
        self.current_file = None
        
        # Create the main window
        if cmds.window("fileOpenerWindow", exists=True):
            cmds.deleteUI("fileOpenerWindow")
        self.window = cmds.window("fileOpenerWindow", title="Maya File Opener", widthHeight=(400, 200))

        # Create layout
        cmds.columnLayout(adjustableColumn=True)
        
        # Dropdown for department (Assets, Shots)
        self.dept_menu = cmds.optionMenu(label="Department", changeCommand=self.update_tasks)
        cmds.menuItem(label="Assets")
        cmds.menuItem(label="Shots")
        
        # Dropdown for task (Model, Rig, Layout, Animation, Lighting)
        self.task_menu = cmds.optionMenu(label="Task", changeCommand=self.update_versions)
        
        # Dropdown for version (WIP or Publish)
        self.version_menu = cmds.optionMenu(label="File Type")
        cmds.menuItem(label="WIP")
        cmds.menuItem(label="Publish")
        
        # Button to browse and open file
        cmds.button(label="Open File", command=self.open_file)
        
        # Show the window
        cmds.showWindow(self.window)

    def update_tasks(self, dept):
        # Clear the task menu
        cmds.optionMenu(self.task_menu, edit=True, deleteAllItems=True)
        
        # Populate task menu based on department selection
        for task in self.dept_paths[dept].keys():
            cmds.menuItem(parent=self.task_menu, label=task)
        
    def update_versions(self, task):
        # Logic to update file versions if needed
        # This is where we would scan directories for available versions in the chosen department/task
        pass

    def open_file(self, *args):
        # Get department, task, and file type
        selected_dept = cmds.optionMenu(self.dept_menu, query=True, value=True)
        selected_task = cmds.optionMenu(self.task_menu, query=True, value=True)
        selected_version = cmds.optionMenu(self.version_menu, query=True, value=True)
        
        # Build the file path
        dept_folder = self.dept_paths[selected_dept][selected_task]
        file_path = os.path.join(self.base_path, selected_dept, dept_folder, selected_version)
        
        # Check if the file exists
        if os.path.exists(file_path):
            cmds.file(file_path, open=True, force=True)
            cmds.confirmDialog(title="Success", message="File opened successfully!", button=["OK"])
        else:
            cmds.confirmDialog(title="Error", message="File not found!", button=["OK"])

# Set the base folder where your project is located
base_folder_path = "C:/your_project_folder"

# Run the tool
MayaFileOpener(base_folder_path)
